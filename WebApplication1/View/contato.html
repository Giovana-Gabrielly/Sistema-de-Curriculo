<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Analista de comunicação</title>
    <!-- Favicon -->
    <link rel="icon" href="assets/images/favicon.png" type="image/x-icon" />
    <!-- Bootstrap CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Animate CSS -->
    <link href="assets/vendors/animate/animate.css" rel="stylesheet" />
    <!-- Icon CSS-->
    <link
      rel="stylesheet"
      href="assets/vendors/font-awesome/css/font-awesome.min.css"
    />

    <!-- Owlcarousel CSS-->
    <link
      rel="stylesheet"
      type="text/css"
      href="assets/vendors/owl_carousel/owl.carousel.css"
      media="all"
    />
    <!--Template Styles CSS-->
    <link
      rel="stylesheet"
      type="text/css"
      href="assets/css/style.css"
      media="all"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700,700i,800,800i&amp;subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="service-banner-img">
      <div class="ovrllay">
        <!-- Header_Area -->
        <nav class="navbar navbar-default header_aera affix-top">
          <div class="container m-s">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="col-md-4 p0">
              <div class="navbar-header">
                <button
                  type="button"
                  class="navbar-toggle collapsed"
                  data-toggle="collapse"
                  data-target="#min_navbar"
                >
                  <span class="sr-only">Analista de comunicação</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand logo-biss" href="index.html">
                  Analista de comunicação
                </a>
              </div>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="col-md-8 p0">
              <div class="collapse navbar-collapse" id="min_navbar">
                <ul class="nav navbar-nav navbar-right">
                  <li class="dropdown submenu">
                    <a href="index.html" class="">Home</a>
                  </li>
                  <li class="dropdown submenu">
                    <a href="sobre.html" class="">Sobre</a>
                  </li>
                  <li class="dropdown submenu">
                    <a href="formacao.html" class=""> Formação</a>
                  </li>
                  <li class="dropdown submenu">
                    <a href="mercado.html" class="">Mercado</a>
                  </li>
                  <li class="dropdown submenu">
                    <a href="perfil.html" class="">Perfil</a>
                  </li>
                  <li class="dropdown submenu">
                    <a href="referencias.html" class="">Referências</a>
                  </li>
                  <li class="dropdown submenu">
                    <a href="contato.html" class="">Contato</a>
                  </li>
                </ul>
              </div>
              <!-- /.navbar-collapse -->
            </div>
          </div>
          <!-- /.container -->
        </nav>
        <!-- End Header_Area -->
        <!-- #banner start -->
        <section id="banner" class="py-70">
          <div class="container">
            <div class="row py-70">
              <!-- #banner-text start -->
              <div id="banner-text" class="col-md-12 text-c">
                <div class="left-borders">
                  <h5
                    class="wow fadeInUp main-about_h"
                    data-wow-delay="0.2s"
                    style="
                      visibility: visible;
                      animation-delay: 0.2s;
                      animation-name: fadeInUp;
                    "
                  >
                    Área de contato
                  </h5>
                  <p
                    class="banner-text wow fadeInUp main-h3"
                    data-wow-delay="0.8s"
                    style="
                      visibility: visible;
                      animation-delay: 0.8s;
                      animation-name: fadeInUp;
                    "
                  ></p>
                </div>
              </div>
              <!-- /#banner-text End -->
            </div>
          </div>
        </section>
      </div>
    </div>
    <!-- /#banner end -->
    <!-- #contact  Area start -->
    <section>
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <div class="section-heading left">
              <h4>Envie seu currículo</h4>
            </div>
            <div class="contact-form-box margin-30px-top">
              <div
                class="no-margin-lr"
                id="success-contact-form"
                style="display: none"
              ></div>
              <form
                id="contactForm"
                method="post"
                class="contact-form"
                action="sendemail.php"
              >
                <div class="row">
                  <div class="col-md-12">
                    <input
                      type="text"
                      class="medium-input"
                      maxlength="50"
                      placeholder="Nome *"
                      required="required"
                      id="Nome"
                      name="Nome"
                    />
                  </div>
                  <div class="col-xs-12 col-sm-6 col-md-6">
                    <input
                      type="email"
                      class="medium-input"
                      maxlength="70"
                      placeholder="E-mail *"
                      required="required"
                      id="Email"
                      name="Email"
                    />
                  </div>
                  <div class="col-xs-12 col-sm-6 col-md-6">
                    <input
                      type="file"
                      class="medium-input"
                      maxlength="70"
                      required="required"
                      id="Arquivo"
                      name="Arquivo"
                    />
                  </div>
                  <div class="col-md-12 sm-margin-30px-bottom">
                    <div
                      class="top-contact wow fadeInRight text-left"
                      style="visibility: visible; animation-name: fadeInRight"
                    >
                      <button
                        type="submit"
                        id="#services"
                        class="btn btn-primary wow fadeInUp radius-50"
                        data-wow-delay="0.5s"
                        style="
                          visibility: visible;
                          animation-delay: 0.5s;
                          animation-name: fadeInUp;
                        "
                      >
                        Enviar
                      </button>
                    </div>
                  </div>
                </div>
              </form>
              <div id="Base" style="display: flex;  "></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- #contact  Area End -->

    <!--#start Our footer Area -->
    <div class="our_footer_area">
      <div class="book_now_aera">
        <div class="container wow fadeInUp">
          <div class="row book_now">
            <div class="col-md-12">
              <p class="color-gray">
                Giovana e Gabrielly 2024 &copy; - Todos os Direitos reservados
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--#End Our footer Area -->
    <!-- jQuery JS -->
    <script src="assets/js/jquery-1.12.0.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- Animate JS -->
    <script src="assets/vendors/animate/wow.min.js"></script>

    <script src="assets/vendors/owl_carousel/owl.carousel.min.js"></script>

    <!-- Theme JS -->
    <script src="assets/js/theme.min.js"></script>
    <script>
      function base64ToPdf(base64String) {
        const byteArray = new Uint8Array(
          atob(base64String)
            .split("")
            .map((char) => char.charCodeAt(0))
        );
        const pdfBlob = new Blob([byteArray], { type: "application/pdf" });
        const pdfUrl = URL.createObjectURL(pdfBlob);
        const iframe = document.createElement("iframe");
        iframe.src = pdfUrl;
        document.body.appendChild(iframe);
        console.log(pdfUrl);
        window.location.assign(pdfUrl);
      }
      getCurriculo();

      function getCurriculo() {
        fetch("https://localhost:7008/Contato")
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            const curriculos = document.getElementById("Base");
            curriculos.innerHTML = "";

            data.forEach((contato) => {
              //console.log('aa');

              const curriculo = document.createElement("div");
              curriculo.innerHTML = `
                <div class="card" style="width: 20rem; ">
                  <div class="card-body">
                    <h1>Currículo</h1>
                  </div>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">Id: ${contato.id}</li>
                    <li class="list-group-item">Nome: ${contato.nome}</li>
                    <li class="list-group-item">Email: ${contato.email}</li>
                  </ul>
                  <div class="card-body">
                    <button
                      class="btn-theme btn-theme-sm btn-default-bg text-uppercase"
                      onclick="base64ToPdf('${contato.arquivo}')"
                    >
                      Ver Currículo
                    </button>
                  </div>
                </div>
                `;
              curriculos.appendChild(curriculo);
            });
          });
      }

      function addCurriculo(event) {
        event.preventDefault();

        const Nome = document.getElementById("Nome").value;
        const Email = document.getElementById("Email").value;

        const inputArquivo = document.getElementById("Arquivo");
        const arquivo = inputArquivo.files[0];

        if (arquivo) {
          const arquivoNome = arquivo.name;
          if (arquivoNome.length > 50) {
            alert("O nome do arquivo é muito grande!");
            document.getElementById("Arquivo").value = "";
            return; // Sai da função se o nome do arquivo for muito grande
          }
          //console.log('Nome do arquivo:', arquivoNome);

          // Convertendo arquivo para formato aceito no varchar(MAX)
          const reader = new FileReader();
          reader.readAsDataURL(arquivo);
          reader.onload = function () {
            const base64String = reader.result.split(",")[1]; // Remove o prefixo "data:application/octet-stream;base64,"
            //console.log('Arquivo convertido:', base64String);

            const curriculo = {
              nome: Nome,
              email: Email,
              nomeArquivo: arquivoNome,
              arquivo: base64String,
            };

            fetch("https://localhost:7008/Contato", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(curriculo),
            }).then((response) => {
              if (response.ok) {
                document.getElementById("Nome").value = "";
                document.getElementById("Email").value = "";
                document.getElementById("Arquivo").value = "";
                alert("Curriculo enviado com sucesso!");
                getCurriculo();
              }
            });
          };
        }
        x;
      }
      document
        .getElementById("contactForm")
        .addEventListener("submit", addCurriculo);
    </script>
  </body>
</html>
